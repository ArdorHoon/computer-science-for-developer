# Spring Event

ìš°ë¦¬ëŠ” ì£¼ë¬¸ ì„œë¹„ìŠ¤ êµ¬í˜„ ì‹œ, ìš”êµ¬ ì‚¬í•­ìœ¼ë¡œ ì£¼ë¬¸ ì•Œë¦¼ ë©”ì„¸ì§€ë¥¼ ì „ë‹¬í•˜ëŠ” ë™ì‹œì— í˜œíƒ ì•ˆë‚´ ì•Œë¦¼ì„ ë™ì‹œì— ì „ì†¡í•œë‹¤ê³  ê°€ì •í•˜ì.

```java

@Service
@RequiredArgsConstructor
public class OrderService {
  private final OrderAlarmService orderAlarmService;
  private final BenefitAlarmService benefitAlarmService;

  public void order(string productName){
      //ì£¼ë¬¸ ë¡œì§ ì²˜ë¦¬
      System.out.println("ì£¼ë¬¸ ì™„ë£Œ");
  
      //ì£¼ë¬¸ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
      orderAlarmService.sens(name);

      //í˜œì±… í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
      benefitAlarmService.send(name);
  }
}


```

ì´ë ‡ê²Œ ë˜ì—ˆì„ ê²½ìš° ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤. 

ìš°ì„  ì£¼ë¬¸ ì„œë¹„ìŠ¤ì— ì£¼ë¬¸ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ ë¡œì§ê³¼ í˜œíƒ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ ë¡œì§ì´ **ëª¨ë‘ ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µê³  ì¶”í›„ í™•ì¥ì´ë‚˜ ìˆ˜ì •ì— ë¬¸ì œ**ê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.

ìš°ë¦¬ëŠ” ìœ„ì™€ ê°™ì€ ìƒí™©ì„ í•´ê²°í•˜ëŠ” ë°©ë²• ì¤‘ì— **Spring Event**ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê°„ì˜ ê°•í•œ ì˜ì¡´ì„±ì„ ì¤„ì´ê³  ìƒì„± ì£¼ì²´ì˜ ìƒíƒœ ë³€ê²½ì— ë”°ë¼ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ í›„ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. (**Spring Framework 4.2 ê¸°ì¤€**)

ì•„ë˜ì—ì„œ Spring Eventë¥¼ ì–´ë–»ê²Œ ì ìš©í•˜ëŠ”ì§€ ë¹ ë¥´ê³  ê°„ë‹¨í•˜ê²Œ ì•Œì•„ë³´ì! 

</br>

## 1ï¸âƒ£ Spring Event 3ê°€ì§€ ìš”ì†Œ

1. Event class (ì´ë²¤íŠ¸ í´ë˜ìŠ¤)
2. Event publisher (ì´ë²¤íŠ¸ ë°œìƒì‹œí‚¤ëŠ” ì£¼ì²´)
3. Event Listener (ì´ë²¤íŠ¸ ë°›ì•„ë“¤ì´ëŠ” ì£¼ì²´)

</br>

### ğŸŸ¢ Event class

ì´ë²¤íŠ¸ í´ë˜ìŠ¤ëŠ” ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°ì´í„°ë¥¼ í¬í•¨í•´ì•¼ í•œë‹¤. ì´ë²¤íŠ¸ ìƒíƒœê°€ ë°”ë€ í›„ì— ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ê³¼ê±°ì‹œì œë¡œ ì‘ì„±í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. 

```java
public class OrderedEvent {

    private String name;

    public OrderEvent(String name){
        this.name = name;
    }

    public String getProductName(){
        return name;
    }
}


```
</br>

### ğŸŸ¢ Event publisher

ì´ë²¤íŠ¸ ë³´ë‚´ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´  ApplicationEventPublisherë¥¼ ì£¼ì…í•´ì£¼ì—ˆê³ ,
ì£¼ë¬¸ ì²˜ë¦¬ë¥¼ ì™„ë£Œí•˜ë©´, publishEventë¥¼ ì‚¬ìš©í•´ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•´ì¤€ë‹¤.

```java
@Service
@RequiredArgsConstructor
public class OrderService {

    /** AS-IS **/
    //    private final OrderAlarmService orderAlarmService;
    //    private final BenefitAlarmService benefitAlarmService;

    private final ApplicationEventPublisher publisher;
    
    public void order(String name){
        //ì£¼ë¬¸ ë¡œì§ ì²˜ë¦¬
        System.out.println("ì£¼ë¬¸ ì™„ë£Œ");

//        //ì£¼ë¬¸ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
//        orderAlarmService.sens(name);
//
//        //í˜œì±… í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
//        benefitAlarmService.send(name);
        
        //ì´ë²¤íŠ¸ ë“±ë¡
        publisher.publishEvent(new OrderedEvent(name));
    }
}

```

</br>

### ğŸŸ¢ Event Listener

ì´ì œ @EventListenerë¥¼ ì‚¬ìš©í•˜ë©´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¡œ ë“±ë¡ì´ ë˜ê³ , ë§¤ê°œë³€ìˆ˜ì— ì´ë²¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ë©´ í•´ë‹¹ ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ ìˆ˜ì‹ í•´ì„œ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.
```java
@Component
@RequiredArgsConstructor
public class AlarmEventHandler {

    @Autowired
    private final OrderAlarmService orderAlarmService;
    
    @Autowired
    private final BenefitAlarmService benefitAlarmService;

    @EventListener
    public void sendOrderAlarm(OrderedEvent event) {
        System.out.println("[AlarmEventHandler - sendOrderAlarm]");
        orderAlarmService.send(event.getName());
    }

    @EventListener
    public void BenefitAlarService(OrderedEvent event) {
        System.out.println("[AlarmEventHandler - benefitAlarmService]");
        benefitAlarmService.send(event.getName());
    }
}


```

</br>

### ğŸŸ¢ ê²°ê³¼ í…ŒìŠ¤íŠ¸

Test ì½”ë“œë¥¼ ë§Œë“¤ì–´ì„œ ì‹¤ì œ ì‹¤í–‰í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. 

```java
    @Autowired
    OrderService orderService;
    
    @Test
    void order(){

        String name ="ardorhoon";
        orderService.order(name);

    }

/** ê²°ê³¼ conole

ì£¼ë¬¸ ì™„ë£Œ
[AlarmEventHandler - sendOrderAlarm]
ardorhoonOrderAlarmService 
[AlarmEventHandler - benefitAlarmService]
ardorhoonBenefitAlarmService 

**/

```

</br>

## 2ï¸âƒ£ ë²ˆì™¸ (ë¹„ë™ê¸° ì²˜ë¦¬)

ë§Œì•½ ê° ì•Œë¦¼ì´ ì²˜ë¦¬í•˜ëŠ”ë° ê°ê° ì‹œê°„(ê° 3ì´ˆ)ì´ ë”°ë¡œ ì˜¤ë˜ê±¸ë¦°ë‹¤ê³  ê°€ì •í•˜ë©´ ìµœì¢… ì£¼ë¬¸ ì™„ë£Œê¹Œì§€ 6ì´ˆì˜ ì‹œê°„ì´ ê±¸ë¦¬ê¸° ë•Œë¬¸ì— ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬ë¥¼ í•´ì£¼ë©´ ëœë‹¤.

</br>

OrderServiceì˜ ì£¼ë¬¸ ë©”ì†Œë“œ

```java

    public void order(String name){
        //ì£¼ë¬¸ ë¡œì§ ì²˜ë¦¬

        System.out.println("==========order method start===========");
        
        System.out.println("ì£¼ë¬¸ ì™„ë£Œ");

//        //ì£¼ë¬¸ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
//        orderAlarmService.sens(name);
//
//        //í˜œì±… í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
//        benefitAlarmService.send(name);

        //ì´ë²¤íŠ¸ ë“±ë¡
        publisher.publishEvent(new OrderedEvent(name));

        System.out.println("==========order method end===========");
    }

```

</br>


ê° ì„œë¹„ìŠ¤ì— Thread sleepì„ í†µí•´ ì‹œê°„ì„ ì§€ì—°ì‹œì¼œì¤€ë‹¤.

```java
@Service
public class OrderAlarmService {
    public void send(String name) throws InterruptedException{
        Thread.sleep(3000); // 3ì´ˆ sleep
        System.out.println(name + "OrderAlarmService ");
    }
}

@Service
public class BenefitAlarmService {

    public void send(String name) throws InterruptedException{
        Thread.sleep(3000); // 3ì´ˆ sleep
        System.out.println(name + "BenefitAlarmService ");
    }
}

```

ê·¸ë¦¬ê³  @EnableAsync ì™€ @Async ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•´ì¤€ë‹¤. 

```java

@SpringBootApplication
@EnableAsync
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

}

/*=================================================*/

@Component
@RequiredArgsConstructor
public class AlarmEventHandler {

    @Autowired
    private final OrderAlarmService orderAlarmService;

    @Autowired
    private final BenefitAlarmService benefitAlarmService;

    @Async
    @EventListener
    public void sendOrderAlarm(OrderedEvent event) throws  InterruptedException{
        System.out.println("[AlarmEventHandler - sendOrderAlarm]");
        orderAlarmService.send(event.getName());
    }

    @Async
    @EventListener
    public void BenefitAlarService(OrderedEvent event)  throws  InterruptedException{
        System.out.println("[AlarmEventHandler - benefitAlarmService]");
        benefitAlarmService.send(event.getName());
    }
}

```


### ğŸŸ¢ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í–ˆì„ ë•Œì™€ ì•ˆí–ˆì„ ë•Œ ê²°ê³½ë°§

</br>

<mark>**ë¹„ë™ê¸° ì²˜ë¦¬ ì•ˆí–ˆì„ ì‹œ**</mark>

```yaml
==========order method start===========
ì£¼ë¬¸ ì™„ë£Œ
[AlarmEventHandler - benefitAlarmService]
ardorhoonBenefitAlarmService 
[AlarmEventHandler - sendOrderAlarm]
ardorhoonOrderAlarmService 
==========order method end===========
```

</br>

<mark>**ë¹„ë™ê¸° ì²˜ë¦¬ í–ˆì„ ì‹œ**</mark>
```yaml
==========order method start===========
ì£¼ë¬¸ ì™„ë£Œ
[AlarmEventHandler - sendOrderAlarm]
==========order method end===========
[AlarmEventHandler - benefitAlarmService]
```
