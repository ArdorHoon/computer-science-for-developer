# í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬

Spring ê³µì‹ ë¬¸ì„œì—ì„œ Springì€ í†µí•© í…ŒìŠ¤íŠ¸ì™€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì§€ì›í•˜ê³  TDDë¥¼ ì§€ì§€í•œë‹¤. ìš©ì–´ë¥¼ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. 

</br>

> <mark>TDD(Test-Driven-Development)</mark> : í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œë¡œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ë¨¼ì € ì‘ì„±í•œ í›„ ì‹¤ì œ ì½”ë“œë¥¼ ê°œë°œí•˜ëŠ” ì ˆì°¨ë¥¼ ì˜ë¯¸í•œë‹¤. </br>
> <mark>í†µí•© í…ŒìŠ¤íŠ¸(Integration Test)</mark> : ë‘ ê°œ ì´ìƒì˜ ë‹¨ìœ„ê°€ í•¨ê»˜ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ </br>
> <mark>ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(Unit Test)</mark> : ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ê³¼ì •ì—ì„œ ê°€ì¥ ì‘ì€ ë‹¨ìœ„ì˜ ì½”ë“œ, ì˜ˆë¥¼ ë“¤ì–´ í•¨ìˆ˜ë‚˜ ë©”ì„œë“œ ë“±ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” í…ŒìŠ¤íŠ¸

</br>


Spring í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¡œ ë§ì´ ì‚¬ìš©ë˜ëŠ” í”„ë ˆì„ì›Œí¬ ìœ„ì£¼ë¡œ ì˜ˆì‹œë¥¼ í™•ì¸í•´ë³´ì. 
* ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ : JUnit5 (java8ë¶€í„° ì§€ì›) 
* Spring MVC í†µí•© í…ŒìŠ¤íŠ¸ : MockMvc 

</br>

## 1ï¸âƒ£ JUnit
<mark>**Javaì—ì„œ ë…ë¦½ëœ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì§€ì›í•´ì£¼ëŠ” í”„ë ˆì„ì›Œí¬**</mark>

ê¸°ë³¸ì ìœ¼ë¡œ JUnitì€ JUnit Platform + JUnit Jupiter + JUnit Vintageë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

* JUnit Platform : JVMì—ì„œ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì‹¤í–‰í•˜ëŠ”ë° ê¸°ì´ˆë¥¼ ì œê³µ
* JUnit Jupiter : JUnit5ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ê³  í™•ì¥ì„ í•˜ê¸° ìœ„í•œ ìƒˆë¡œìš´ í”„ë¡œê·¸ë˜ë° ëª¨ë¸ê³¼ í™•ì¥ ëª¨ë¸ì˜ ì¡°í•©
* JUnit Vintage : í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ JUnit3ì™€ JUnit4ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëŒì•„ê°€ëŠ” í”Œë«í¼ì— í…ŒìŠ¤íŠ¸ ì—”ì§„ ì œê³µ


ì•„ë˜ì™€ ê°™ì´ Junitì„ í†µí•´ ê°„ë‹¨í•˜ê²Œ ë©”ì†Œë“œë¥¼ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. 

```java
import static org.junit.jupiter.api.Assertions.assertEquals;
import org.junit.jupiter.api.Test;

public class ExampleTest {

    private  final SimpleModel simpleModel = new SimpleModel();

    @Test
    public void Test(){
       assertEquals(2, simpleModel.add(1,1));
    }

}
```

ê·¸ë¦¬ê³  ì´ë¥¼ Give-When-Then Patternìœ¼ë¡œ ì‘ì„±í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. 

```java
@Test
public void findByName() {
    //given -> í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì„ ìœ„í•œ ì¡°ê±´ ì„¤ì •
    Member member1 = new Member();
    member1.setName("spring1");
    repository.save(member1);
    Member member2 = new Member();
    member2.setName("spring2");
    repository.save(member2);

    //when -> ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸ í•˜ê¸° ìœ„í•œ ì½”ë“œ ì‘ì„±
    Member result = repository.findByName("spring1").get();

    //then -> í…ŒìŠ¤íŠ¸ ê²°ê³¼
    assertThat(result).isEqualTo(member1);
}

```

</br>

### â™¦ï¸ Junit Annotation
* @Test : ì„ ì–¸ ì‹œ, í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë©”ì†Œë“œê°€ ë¨ 
* @Ignore : ì„ ì–¸ ì‹œ, í•´ë‹¹ ë©”ì†Œë“œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê²Œ í•¨
* @BeforeAll  : í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸° ì „ ë”± í•œë²ˆ ë§Œ ì‹¤í–‰
* @AfterAll :í…ŒìŠ¤íŠ¸ê°€ ì™„ì „íˆ ëë‚œ í›„ ë”± í•œë²ˆ ë§Œ ì‹¤í–‰
* @BeforeEach : í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ê¸°ì „ì— ì‹¤í–‰ë˜ì–´ì•¼ í•˜ëŠ” ë©”ì†Œë“œë¥¼ ëª…ì‹œ(ì¼ë°˜ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì „ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ì„¸íŒ…í•´ì£¼ê¸° ìœ„í•´ ì£¼ë¡œ ì‚¬ìš©)
* @AfterEach : @Testê°€ ë¶™ì€ í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ê³  ë‚œ í›„ ì‹¤í–¥(ì¼ë°˜ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ ì´ˆê¸°í™”ë¥¼ ìœ„í•´ ì‚¬ìš©)

</br>

ì´ë¥¼ ë„ì‹í™”í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. 

<p align="center">
<img src="https://github.com/user-attachments/assets/47ed8094-06a2-458c-bed0-1244d64249a7" width="10%" height="10%"></br>
</p></br>


### â™¦ï¸ Junit Annotation
ì–´ë…¸í…Œì´ì…˜ê³¼ ë”ë¶ˆì–´ ì¤‘ìš”í•œ JUnit Assertì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì. assertëŠ” í…ŒìŠ¤íŠ¸ì— ë„£ì„ ìˆ˜ ìˆëŠ” ì •ì  ë©”ì„œë“œ í˜¸ì¶œì´ë‹¤. ê° Assert êµ¬ë¬¸ì€ ì–´ë–¤ ì¡°ê±´ì´ ì°¸ì¸ì§€ ê²€ì¦í•œë‹¤. ë§Œì•½ ì„¤ì •í•œ ì¡°ê±´ì´ ì°¸ì´ ì•„ë‹ˆë©´ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•œë‹¤.

</br>

#### ğŸ» assertEquals()
ì˜¤ë¥¸ìª½ì˜ ê²°ê³¼ê°€ ì™¼ìª½ê³¼ ë™ì¼í•œì§€ í™•ì¸í•˜ëŠ” êµ¬ë¬¸

```java
@Test
public void Test(){
    assertEquals(2, simpleModel.add(1,1));
}
````
</br>

#### ğŸ» assertTrue()
í•´ë‹¹ í•¨ìˆ˜ì˜ return ê°’ì´ trueì´ë©´ ì„±ê³µ
```java
@Test
public void Test(){
    assertTrue(true); //trueì— íŠ¹ì • í•¨ìˆ˜ ì‚½ì…
}
````
</br>

#### ğŸ» assertTimeout()

íŠ¹ì • ì‹œê°„ë™ì•ˆ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ì§€ ì•Šìœ¼ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤íŒ¨ì‹œí‚¤ëŠ” êµ¬ë¬¸

```java
@Test
public void Test(){
    assertTimeout(Duration.ofMinutes(1), () -> {
        //1ë¶„ ë¯¸ë§Œìœ¼ë¡œ ë™ì‘ë˜ëŠ” í•¨ìˆ˜ ì‹¤í–‰
    });
}
```

</br>


#### ğŸ» assertTimeoutPreemptively()
íŠ¹ì • ì‹œê°„ë™ì•ˆ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ì§€ ì•Šìœ¼ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤íŒ¨ì‹œí‚¤ëŠ” êµ¬ë¬¸ í•˜ì§€ë§Œ ìœ„ì™€ ë‹¤ë¥´ê²Œ íŠ¹ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ì¢…ë£Œ

```java
@Test
public void Test(){
    assertTimeoutPreemptively(Duration.ofMinutes(20), () -> {
        // 20ë¶„ ì´ìƒ ê±¸ë¦¬ëŠ” ì‘ì—…
    });
}
```

í•˜ì§€ë§Œ JUnit Jupiterê°€ ì œê³µí•´ì£¼ëŠ” assertionì€ ë§ì€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ì—ëŠ” ë¶€ì¡±í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— JUnitì—ì„œ AssertJ ,Truth, Hamcrestì™€ ê°™ì€ ì¨ë“œ íŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì“°ëŠ” ê±¸ ì¶”ì²œí•œë‹¤.

</br>

## 2ï¸âƒ£ MockMVC

<mark>**Spring í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µí•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ í…ŒìŠ¤íŠ¸ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬**</mark>

ì£¼ë¡œ Controllerì˜ ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ”ë° ì‚¬ìš©í•œë‹¤. MockMvcë¥¼ ì‚¬ìš©í•˜ë©´ HTTP ìš”ì²­ì„ ì‘ì„±í•˜ê³  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì‘ë‹µì„ ê²€ì¦í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ ì‹¤ì œ ì„œë²„ì— êµ¬í˜„í•œ Applicationì„ ì˜¬ë¦¬ì§€ ì•Šê³  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë™ì‘ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.

</br>


### â™¦ï¸ GET ë°©ì‹ ì‚¬ìš©ë²•

ì•„ë˜ì™€ ê°™ì€ Controllerì˜ GET ìš”ì²­ì„ í…ŒìŠ¤íŠ¸ í•´ë³´ìê³  í•˜ì. (@RestController : Spring 4.0ì—ì„œ ì¶”ê°€ ê¸°ì¡´ @Controllerì— @ResponseBodyê°€ ì¶”ê°€, JSON ë˜ëŠ” XML í˜•ì‹ìœ¼ë¡œ HTTP ì‘ë‹µì— ë‹´ì•„ì„œ ì „ì†¡)

</br>

```java
@RestController
public class TestController {

    @GetMapping("/test")
    public String testGet(@RequestParam String name, @RequestParam String id){
        return name +": "+ id;
    }
}

```

í•´ë‹¹ Controllerì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ì–´ì¤€ë‹¤.

```java
@RunWith(SpringRunner.class)
@WebMvcTest(TestController.class)
class TestControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @Test
    void testGet() throws Exception {

        MultiValueMap<String, String> info = new LinkedMultiValueMap<>();

        info.add("name", "Jake");
        info.add("id", "11250");

        mockMvc.perform(
                MockMvcRequestBuilders.get("/test")
                        .params(info))
                .andExpect(status().isOk())
                .andExpect(content().string("Jake: 11250"))
                .andDo(print());

    }
}

```


 * perform() : ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” ì—­í• , ê²°ê³¼ë¥¼ <code>ResultActions</code> ê°ì²´ë¥¼ ë°›ìœ¼ë©°, í•´ë‹¹ ê°ì²´ëŠ” ë¦¬í„´ ê°’ì„ ê²€ì¦í•  ìˆ˜ ìˆëŠ” <code>andExpect()</code> ë©”ì†Œë“œë¥¼ ì œê³µ 
 * get("url path") : HTTP ë©”ì†Œë“œ ê²°ì •í•  ìˆ˜ ìˆìŒ(<code>get()</code>, <code>post()</code>, <code>put()</code>, <code>delete()</code>)
 * params() : <í‚¤, ê°’> íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŒ (ì—¬ëŸ¬ ê°œì¼ ë•ŒëŠ” **params()**, í•˜ë‚˜ì¼ ë•ŒëŠ” **param()**ì„ ì‚¬ìš©)
 * andExpect() : ì‘ë‹µì„ ê²€ì¦í•˜ëŠ” ì—­í• 
   * status() - ìƒíƒœì½”ë“œ
   * view() - ë¦¬í„´í•˜ëŠ” ë·° ì´ë¦„ ê²€ì¦ (view().name("test")
   * redirect() - ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‘ë‹µì„ ê²€ì¦
   * content() - ì‘ë‹µì •ë³´ ê²€ì¦
 * andDo(print()) : ìš”ì²­/ì‘ë‹µ ì „ì²´ ë©”ì‹œì§€ í™•ì¸ ê°€ëŠ¥  

</br>

ì‹¤ì œ í•´ë‹¹ ê²°ê³¼ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë©´ ì¸í…”ë¦¬ì œì´ì—ì„œ ì•„ë˜ì™€ ê°™ì´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  (í…ŒìŠ¤íŠ¸ í†µê³¼)

![result](https://github.com/user-attachments/assets/34e85a70-337f-494e-b1ae-1f316ef23425)


</br>


### â™¦ï¸ POST ë°©ì‹ ì‚¬ìš©ë²•

ì´ë²ˆì—ëŠ” POST ë°©ì‹ì—ì„œ ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸í•˜ëŠ”ê°€ í™•ì¸í•´ ë³´ì

```java

//lombokìœ¼ë¡œ êµ¬í˜„í•œ User í´ë˜ìŠ¤
@Getter
@Setter
@AllArgsConstructor
public class User {
    private String name;
    private String id;
}


//TestController
@RestController
@RequestMapping("/start")
public class TestController {

    @PostMapping("/test")
    public String testGet(@RequestBody User user){
        return user.getName() + ": "+ user.getId();
    }
}

```

í•´ë‹¹ POST ë©”ì†Œë“œë¥¼ MockMVC í…ŒìŠ¤íŠ¸ë¡œ ì‘ì„±í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```java

@RunWith(SpringRunner.class)
@WebMvcTest(TestController.class)
class TestControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @Autowired
    private ObjectMapper objectMapper;

    @Test
    void testGet() throws Exception {

        String content = objectMapper.writeValueAsString(new User("Jake", "11020"));

        mockMvc.perform(
                        MockMvcRequestBuilders.post("/start/test")
                                .content(content)
                                .contentType(MediaType.APPLICATION_JSON)
                                .accept(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(content().string("Jake: 11020"))
                .andDo(print());

    }


}

```

ì´ì— ë”°ë¥¸ ê²°ê³¼ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜¨ë‹¤. (í…ŒìŠ¤íŠ¸ í†µê³¼)


![result2](https://github.com/user-attachments/assets/ca9fdb90-757d-49cb-a322-83bb8759326e)

</br>

